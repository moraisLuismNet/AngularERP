<div class="customers-container">
  <div class="header">
    <h1>Customer Management</h1>
    <button class="btn btn-primary" (click)="createNewCustomer()">
      New Customer
    </button>
  </div>

  @if (!loading && !hasError && customers.length > 0) {
  <div class="customers-table">
    <!-- Desktop Table View -->
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Location</th>
          <th>Type</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (customer of customers; track customer.id) {
        <tr>
          <td class="name-cell">
            <strong>{{ getFullName(customer) }}</strong>
          </td>
          <td class="email-cell">
            <a href="mailto:{{ customer.email }}" class="email-link">{{
              customer.email
            }}</a>
          </td>
          <td class="phone-cell">
            <a href="tel:{{ customer.phone }}" class="phone-link">{{
              customer.phone
            }}</a>
          </td>
          <td class="location-cell">
            <div class="city">{{ customer.city }}</div>
          </td>
          <td class="type-cell">
            <div class="customer-type">{{ customer.customerType }}</div>
          </td>
          <td class="actions-cell">
            <button
              class="btn btn-sm btn-secondary"
              (click)="editCustomerModal(customer)"
            >
              Edit
            </button>
            <button
              class="btn btn-sm btn-info"
              (click)="viewCustomerDetail(customer)"
            >
              View Detail
            </button>
            <button
              class="btn btn-sm btn-danger"
              (click)="confirmDeleteCustomer(customer)"
            >
              Delete
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>

    <!-- Mobile Card View -->
    @for (customer of customers; track customer.id) {
    <div class="customer-card">
      <div class="customer-header">
        <div class="customer-avatar">
          {{ getFullName(customer).charAt(0).toUpperCase() }}
        </div>
        <div class="customer-title">
          <strong>{{ getFullName(customer) }}</strong>
          <a href="mailto:{{ customer.email }}" class="customer-email-mobile">
            {{ customer.email }}
          </a>
        </div>
      </div>

      <div class="customer-meta">
        <span class="customer-type-badge">{{ customer.customerType }}</span>
      </div>

      <div class="customer-info-mobile">
        @if (customer.phone) {
        <div class="customer-info-row">
          <span class="icon">üìû</span>
          <a href="tel:{{ customer.phone }}">{{ customer.phone }}</a>
        </div>
        } @if (customer.city) {
        <div class="customer-info-row">
          <span class="icon">üìç</span>
          <span>{{ customer.city }}</span>
        </div>
        }
      </div>

      <div class="customer-actions">
        <button class="btn btn-secondary" (click)="editCustomerModal(customer)">
          Edit
        </button>
        <button class="btn btn-info" (click)="viewCustomerDetail(customer)">
          View Detail
        </button>
        <button
          class="btn btn-danger"
          (click)="confirmDeleteCustomer(customer)"
        >
          Delete
        </button>
      </div>
    </div>
    }
  </div>
  } @if (loading) {
  <div class="loading">
    <p>Loading customers...</p>
  </div>
  } @if (hasError) {
  <div class="error-section">
    <div class="error-card">
      <h3>‚ö†Ô∏è Connection Error</h3>
      <p>{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="retryLoad()">Retry</button>
    </div>
  </div>
  } @if (!loading && !hasError && customers.length === 0) {
  <div class="empty-state">
    <p>No customers registered</p>
    <button class="btn btn-primary" (click)="createNewCustomer()">
      Add First Customer
    </button>
  </div>
  }
</div>
<!-- Create Customer Modal -->
@if (showCreateModal) {
<div class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Customer</h2>
      <button class="modal-close" (click)="closeCreateModal()">&times;</button>
    </div>

    <form (ngSubmit)="onSubmitCreate()" #createForm="ngForm">
      <div class="modal-body">
        @if (createError) {
        <div class="error-message">
          {{ createError }}
        </div>
        }

        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name *</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              [(ngModel)]="newCustomer.firstName"
              required
              class="form-control"
              placeholder="Enter first name"
            />
          </div>

          <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              [(ngModel)]="newCustomer.lastName"
              required
              class="form-control"
              placeholder="Enter last name"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="newCustomer.email"
            required
            class="form-control"
            placeholder="customer@example.com"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="phone">Phone</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              [(ngModel)]="newCustomer.phone"
              class="form-control"
              placeholder="+1234567890"
            />
          </div>

          <div class="form-group">
            <label for="customerType">Customer Type</label>
            <select
              id="customerType"
              name="customerType"
              [(ngModel)]="newCustomer.customerType"
              class="form-control"
            >
              <option value="regular">Regular</option>
              <option value="premium">Premium</option>
              <option value="corporate">Corporate</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <input
            type="text"
            id="address"
            name="address"
            [(ngModel)]="newCustomer.address"
            class="form-control"
            placeholder="Enter street address"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">City</label>
            <input
              type="text"
              id="city"
              name="city"
              [(ngModel)]="newCustomer.city"
              class="form-control"
              placeholder="Enter city"
            />
          </div>

          <div class="form-group">
            <label for="stateProvince">State/Province</label>
            <input
              type="text"
              id="stateProvince"
              name="stateProvince"
              [(ngModel)]="newCustomer.stateProvince"
              class="form-control"
              placeholder="Enter state or province"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="postalCode">Postal Code</label>
            <input
              type="text"
              id="postalCode"
              name="postalCode"
              [(ngModel)]="newCustomer.postalCode"
              class="form-control"
              placeholder="Enter postal code"
            />
          </div>

          <div class="form-group">
            <label for="country">Country</label>
            <input
              type="text"
              id="country"
              name="country"
              [(ngModel)]="newCustomer.country"
              class="form-control"
              placeholder="Enter country"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="paymentMethod">Default Payment Method</label>
          <select
            id="paymentMethod"
            name="paymentMethod"
            [(ngModel)]="newCustomer.defaultPaymentMethod"
            class="form-control"
          >
            <option value="card">Credit/Debit Card</option>
            <option value="transfer">Bank Transfer</option>
            <option value="cash">Cash</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeCreateModal()"
          [disabled]="creatingCustomer"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="creatingCustomer || !createForm.form.valid"
        >
          @if (creatingCustomer) { Creating... } @else { Create Customer }
        </button>
      </div>
    </form>
  </div>
</div>
}

<!-- Edit Customer Modal -->
@if (showEditModal) {
<div class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Edit Customer</h2>
      <button class="modal-close" (click)="closeEditModal()">&times;</button>
    </div>

    <form (ngSubmit)="onSubmitEdit()" #editForm="ngForm">
      <div class="modal-body">
        @if (editError) {
        <div class="error-message">
          {{ editError }}
        </div>
        }

        <div class="form-row">
          <div class="form-group">
            <label for="editFirstName">First Name *</label>
            <input
              type="text"
              id="editFirstName"
              name="editFirstName"
              [(ngModel)]="editCustomer.firstName"
              required
              class="form-control"
              placeholder="Enter first name"
            />
          </div>

          <div class="form-group">
            <label for="editLastName">Last Name *</label>
            <input
              type="text"
              id="editLastName"
              name="editLastName"
              [(ngModel)]="editCustomer.lastName"
              required
              class="form-control"
              placeholder="Enter last name"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="editEmail">Email *</label>
          <input
            type="email"
            id="editEmail"
            name="editEmail"
            [(ngModel)]="editCustomer.email"
            required
            class="form-control"
            placeholder="customer@example.com"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="editPhone">Phone</label>
            <input
              type="tel"
              id="editPhone"
              name="editPhone"
              [(ngModel)]="editCustomer.phone"
              class="form-control"
              placeholder="+1234567890"
            />
          </div>

          <div class="form-group">
            <label for="editCustomerType">Customer Type</label>
            <select
              id="editCustomerType"
              name="editCustomerType"
              [(ngModel)]="editCustomer.customerType"
              class="form-control"
            >
              <option value="regular">Regular</option>
              <option value="premium">Premium</option>
              <option value="corporate">Corporate</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="editAddress">Address</label>
          <input
            type="text"
            id="editAddress"
            name="editAddress"
            [(ngModel)]="editCustomer.address"
            class="form-control"
            placeholder="Enter street address"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="editCity">City</label>
            <input
              type="text"
              id="editCity"
              name="editCity"
              [(ngModel)]="editCustomer.city"
              class="form-control"
              placeholder="Enter city"
            />
          </div>

          <div class="form-group">
            <label for="editStateProvince">State/Province</label>
            <input
              type="text"
              id="editStateProvince"
              name="editStateProvince"
              [(ngModel)]="editCustomer.stateProvince"
              class="form-control"
              placeholder="Enter state or province"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="editPostalCode">Postal Code</label>
            <input
              type="text"
              id="editPostalCode"
              name="editPostalCode"
              [(ngModel)]="editCustomer.postalCode"
              class="form-control"
              placeholder="Enter postal code"
            />
          </div>

          <div class="form-group">
            <label for="editCountry">Country</label>
            <input
              type="text"
              id="editCountry"
              name="editCountry"
              [(ngModel)]="editCustomer.country"
              class="form-control"
              placeholder="Enter country"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="editPaymentMethod">Default Payment Method</label>
          <select
            id="editPaymentMethod"
            name="editPaymentMethod"
            [(ngModel)]="editCustomer.defaultPaymentMethod"
            class="form-control"
          >
            <option value="card">Credit/Debit Card</option>
            <option value="transfer">Bank Transfer</option>
            <option value="cash">Cash</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeEditModal()"
          [disabled]="editingCustomer"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editingCustomer || !editForm.form.valid"
        >
          @if (editingCustomer) { Updating... } @else { Update Customer }
        </button>
      </div>
    </form>
  </div>
</div>
}

<!-- View Customer Detail Modal -->
@if (showDetailModal) {
<div class="modal-overlay" (click)="closeDetailModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Customer Details</h2>
      <button class="modal-close" (click)="closeDetailModal()">&times;</button>
    </div>

    <div class="modal-body">
      @if (loadingDetail) {
      <div class="loading-detail">
        <p>Loading customer details...</p>
      </div>
      } @else if (detailError) {
      <div class="error-message">
        {{ detailError }}
      </div>
      } @else if (customerDetail) {
      <div class="customer-detail-content">
        <!-- Personal Information -->
        <div class="detail-section">
          <h3>Personal Information</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Full Name:</label>
              <span
                >{{ customerDetail.firstName }}
                {{ customerDetail.lastName }}</span
              >
            </div>
            <div class="detail-item">
              <label>Email:</label>
              <span>
                <a href="mailto:{{ customerDetail.email }}" class="email-link">
                  {{ customerDetail.email }}
                </a>
              </span>
            </div>
            <div class="detail-item">
              <label>Phone:</label>
              <span>
                @if (customerDetail.phone) {
                <a href="tel:{{ customerDetail.phone }}" class="phone-link">
                  {{ customerDetail.phone }}
                </a>
                } @else {
                <span class="no-data">Not provided</span>
                }
              </span>
            </div>
            <div class="detail-item">
              <label>Customer Type:</label>
              <span class="customer-type-badge">{{
                customerDetail.customerType
              }}</span>
            </div>
          </div>
        </div>

        <!-- Address Information -->
        <div class="detail-section">
          <h3>Address Information</h3>
          <div class="detail-grid">
            <div class="detail-item full-width">
              <label>Street Address:</label>
              <span>{{ customerDetail.address || "Not provided" }}</span>
            </div>
            <div class="detail-item">
              <label>City:</label>
              <span>{{ customerDetail.city || "Not provided" }}</span>
            </div>
            <div class="detail-item">
              <label>State/Province:</label>
              <span>{{ customerDetail.stateProvince || "Not provided" }}</span>
            </div>
            <div class="detail-item">
              <label>Postal Code:</label>
              <span>{{ customerDetail.postalCode || "Not provided" }}</span>
            </div>
            <div class="detail-item">
              <label>Country:</label>
              <span>{{ customerDetail.country || "Not provided" }}</span>
            </div>
          </div>
        </div>

        <!-- Account Information -->
        <div class="detail-section">
          <h3>Account Information</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Customer ID:</label>
              <span class="customer-id">#{{ customerDetail.id }}</span>
            </div>
            <div class="detail-item">
              <label>Default Payment Method:</label>
              <span class="payment-method">
                @if (customerDetail.defaultPaymentMethod === 'card') {
                Credit/Debit Card } @else if
                (customerDetail.defaultPaymentMethod === 'transfer') { Bank
                Transfer } @else if (customerDetail.defaultPaymentMethod ===
                'cash') { Cash } @else {
                {{ customerDetail.defaultPaymentMethod }}
                }
              </span>
            </div>
            <div class="detail-item">
              <label>Account Status:</label>
              <span
                class="status-badge"
                [class.active]="customerDetail.isActive"
                [class.inactive]="!customerDetail.isActive"
              >
                {{ customerDetail.isActive ? "Active" : "Inactive" }}
              </span>
            </div>
          </div>
        </div>
      </div>
      }
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="closeDetailModal()"
      >
        Close
      </button>
      @if (customerDetail) {
      <button
        type="button"
        class="btn btn-primary"
        (click)="
          editCustomerModal({
            id: customerDetail.id,
            firstName: customerDetail.firstName,
            lastName: customerDetail.lastName,
            email: customerDetail.email,
            phone: customerDetail.phone,
            city: customerDetail.city,
            customerType: customerDetail.customerType,
            isActive: customerDetail.isActive
          });
          closeDetailModal()
        "
      >
        Edit Customer
      </button>
      }
    </div>
  </div>
</div>
}
<!-- Delete Customer Confirmation Modal -->
@if (showDeleteModal) {
<div class="modal-overlay" (click)="closeDeleteModal()">
  <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Delete Customer</h2>
      <button class="modal-close" (click)="closeDeleteModal()">&times;</button>
    </div>

    <div class="modal-body">
      @if (deleteError) {
      <div class="error-message">
        {{ deleteError }}
      </div>
      }

      <div class="delete-confirmation">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h3>Are you sure you want to delete this customer?</h3>

        @if (customerToDelete) {
        <div class="customer-info">
          <strong>{{ getFullNameForDelete() }}</strong>
          <p><strong>Email:</strong> {{ customerToDelete.email }}</p>
          <p>
            <strong>Phone:</strong>
            {{ customerToDelete.phone || "Not provided" }}
          </p>
          <p>
            <strong>City:</strong> {{ customerToDelete.city || "Not provided" }}
          </p>
          <p><strong>Type:</strong> {{ customerToDelete.customerType }}</p>
        </div>
        }

        <p class="warning-text">
          This action cannot be undone. The customer and all associated data
          will be permanently removed from the system.
        </p>
      </div>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="closeDeleteModal()"
        [disabled]="deletingCustomer"
      >
        Cancel
      </button>
      <button
        type="button"
        class="btn btn-danger"
        (click)="deleteCustomer()"
        [disabled]="deletingCustomer"
      >
        @if (deletingCustomer) { Deleting... } @else { Delete Customer }
      </button>
    </div>
  </div>
</div>
}
