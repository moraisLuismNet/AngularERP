<div class="cart-container">
  <!-- Header -->
  <div class="cart-header">
    <h1>üõí My Shopping Cart</h1>
  </div>

  <!-- Loading State -->
  @if (loading) {
  <div class="loading-state">
    <p>Loading cart...</p>
  </div>
  }

  <!-- Error State -->
  @if (error) {
  <div class="error-state">
    <div class="alert alert-danger">
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadCart()">Retry</button>
    </div>
  </div>
  }

  <!-- Checkout Success -->
  @if (checkoutSuccess) {
  <div class="success-state">
    <div class="alert alert-success">
      <h3>üéâ Order Placed!</h3>
      <p>{{ checkoutMessage }}</p>
    </div>
  </div>
  }

  <!-- Empty Cart -->
  @if (!loading && !error && isEmpty) {
  <div class="empty-cart">
    <div class="empty-cart-content">
      <h2>Your cart is empty</h2>
      <p>Add some products to get started!</p>
      <button class="btn btn-primary" (click)="continueShopping()">
        Explore Products
      </button>
    </div>
  </div>
  }

  <!-- Cart with Items -->
  @if (!loading && !error && !isEmpty && cart) {
  <div class="cart-content">
    <!-- Cart Items -->
    <div class="cart-items">
      <h2>Products in your cart ({{ getTotalItems() }} items)</h2>

      @for (item of cart.items; track item.productId) {
      <div class="cart-item">
        <div class="item-image">
          @if (item.imageUrl) {
          <img [src]="item.imageUrl" [alt]="item.productName" />
          } @else {
          <div class="placeholder-image">
            <span>üì¶</span>
          </div>
          }
        </div>

        <div class="item-details">
          <h3>{{ item.productName }}</h3>
          <p class="item-price">
            {{ item.price | currency : "EUR" : "symbol" : "1.2-2" : "es" }}
          </p>
          <p class="item-stock">Stock available: {{ item.stock }}</p>
        </div>

        <div class="item-quantity">
          <label>Amount:</label>
          <div class="quantity-controls">
            <button
              class="btn btn-sm btn-outline"
              (click)="decreaseQuantity(item)"
              [disabled]="loading"
            >
              -
            </button>
            <span class="quantity-display">{{ item.quantity }}</span>
            <button
              class="btn btn-sm btn-outline"
              (click)="increaseQuantity(item)"
              [disabled]="loading || item.quantity >= item.stock"
            >
              +
            </button>
          </div>
        </div>

        <div class="item-total">
          <p class="total-price">
            {{
              item.price * item.quantity
                | currency : "EUR" : "symbol" : "1.2-2" : "es"
            }}
          </p>
        </div>

        <div class="item-actions">
          <button
            class="btn btn-sm btn-danger"
            (click)="removeItem(item.productId)"
            [disabled]="loading"
          >
            üóëÔ∏è Eliminate
          </button>
        </div>
      </div>
      }
    </div>

    <!-- Cart Summary -->
    <div class="cart-summary">
      <div class="summary-card">
        <h3>Order Summary</h3>

        <div class="summary-line">
          <span>Subtotal:</span>
          <span>{{
            cart.totalAmount | currency : "EUR" : "symbol" : "1.2-2" : "es"
          }}</span>
        </div>

        <div class="summary-line">
          <span>Shipment:</span>
          <span>Free</span>
        </div>

        <div class="summary-line total-line">
          <span><strong>Total:</strong></span>
          <span
            ><strong>{{
              cart.totalAmount | currency : "EUR" : "symbol" : "1.2-2" : "es"
            }}</strong></span
          >
        </div>

        <div class="summary-actions">
          <button
            class="btn btn-primary btn-block"
            (click)="proceedToCheckout()"
            [disabled]="loading || processingCheckout"
          >
            @if (processingCheckout) { üîÑ Processing Order... } @else { üí≥
            Proceed to Payment }
          </button>

          <button
            class="btn btn-secondary btn-block"
            (click)="continueShopping()"
          >
            Continue Shopping
          </button>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Authentication Required -->
  @if (!isAuthenticated) {
  <div class="auth-required">
    <div class="auth-card">
      <h2>Log in to view your cart</h2>
      <p>You need to be authenticated to access your shopping cart</p>
      <a routerLink="/login" class="btn btn-primary">Login</a>
    </div>
  </div>
  }
</div>
